<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ôn tập trắc nghiệm - Nhiều bộ đề</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="tabs">
    <button class="tab-btn active" data-file="questions1.js">Đề 1</button>
    <button class="tab-btn" data-file="questions2.js">Đề 2</button>
  </div>

  <div class="container">
    <div class="quiz-section">
      <h1>Ôn tập - 120 câu trắc nghiệm</h1>
      <p class="subtitle">Chọn đề ở trên để bắt đầu</p>

      <div id="question-number"></div>
      <div id="question-text"></div>
      <div id="choices"></div>

      <div class="nav-buttons">
        <button id="prev-btn">‹ Trước</button>
        <button id="next-btn">Tiếp ›</button>
      </div>
    </div>

    <div class="sidebar">
      <h2>Tổng quan</h2>
      <div id="question-grid"></div>

      <div class="sidebar-buttons">
        <button id="shuffle-btn">Xáo câu</button>
        <button id="clear-progress-btn">Xóa tiến độ</button>
      </div>
    </div>
  </div>

  <footer>Ứng dụng chạy hoàn toàn offline. Mỗi tab tương ứng một bộ đề riêng.</footer>

  <script>
    let questions = [];
    let currentIndex = 0;
    let currentFile = null;

    const questionNumber = document.getElementById("question-number");
    const questionText = document.getElementById("question-text");
    const choicesContainer = document.getElementById("choices");
    const questionGrid = document.getElementById("question-grid");

    // === Hàm tải file đề ===
    async function loadQuestions(file) {
      currentFile = file;
      const res = await fetch(file);
      const text = await res.text();

      // Tách phần JSON từ file questions.js (bỏ const ... ;)
      const jsonText = text
        .replace(/^const\s+questions\s*=\s*/, "")
        .replace(/;$/, "");

      try {
        questions = JSON.parse(jsonText);
      } catch (err) {
        console.error("❌ Lỗi khi đọc file:", file, err);
        alert("Không thể đọc file " + file);
        return;
      }

      currentIndex = 0;
      renderGrid();
      renderQuestion();
    }


    function renderQuestion() {
      const q = questions[currentIndex];
      if (!q) return;
      questionNumber.textContent = `Câu ${q.id}/${questions.length}`;
      questionText.innerHTML = `<strong>${q.text}</strong>`;
      choicesContainer.innerHTML = "";

      for (const [key, value] of Object.entries(q.choices)) {
        const btn = document.createElement("button");
        btn.textContent = `${key}. ${value}`;
        btn.className = "choice-btn";

        btn.addEventListener("click", () => {
          const all = choicesContainer.querySelectorAll("button");
          all.forEach(b => b.disabled = true);

          const gridBtn = document.querySelectorAll(".grid-btn")[currentIndex];
          gridBtn.classList.remove("answered", "wrong");

          if (key === q.answer) {
            btn.classList.add("correct");
            gridBtn.classList.add("answered");
          } else {
            btn.classList.add("incorrect");
            gridBtn.classList.add("wrong");
            const correctBtn = Array.from(all).find(b => b.textContent.startsWith(q.answer + "."));
            if (correctBtn) correctBtn.classList.add("correct");
          }
        });

        choicesContainer.appendChild(btn);
      }
    }

    function renderGrid() {
      questionGrid.innerHTML = "";
      questions.forEach((q, i) => {
        const btn = document.createElement("button");
        btn.textContent = q.id;
        btn.className = "grid-btn";
        btn.addEventListener("click", () => {
          currentIndex = i;
          renderQuestion();
        });
        questionGrid.appendChild(btn);
      });
    }

    document.getElementById("next-btn").onclick = () => {
      if (currentIndex < questions.length - 1) currentIndex++;
      renderQuestion();
    };
    document.getElementById("prev-btn").onclick = () => {
      if (currentIndex > 0) currentIndex--;
      renderQuestion();
    };

    document.getElementById("shuffle-btn").onclick = () => {
      questions.sort(() => Math.random() - 0.5);
      renderGrid();
      currentIndex = 0;
      renderQuestion();
    };

    document.getElementById("clear-progress-btn").onclick = () => {
      document.querySelectorAll(".grid-btn").forEach(b => b.classList.remove("answered", "wrong"));
    };

    // === Tabs chuyển đề ===
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        loadQuestions(btn.dataset.file);
      });
    });

    // Tự động tải đề đầu tiên
    loadQuestions("questions1.js");
  </script>
</body>

</html>